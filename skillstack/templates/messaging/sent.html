{% extends 'base.html' %}
{% block title %}Sent Messages{% endblock %}

{% block content %}
<div class="container mt-5">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="mb-0">Sent Messages</h2>
    <a href="{% url 'compose' %}" class="btn btn-dark">New Message</a>
  </div>

  {% with items=messages|default:messages %}
    {% if items %}
      <ul class="list-group">
        {% for msg in items %}
          <li class="list-group-item">
            <div class="d-flex justify-content-between align-items-start">
              <div class="pe-3">
                <a href="{% url 'message_detail' msg.pk %}" class="fw-semibold text-decoration-none">{{ msg.subject|default:"(no subject)" }}</a>
                <div class="small text-muted">To: {{ msg.recipient.get_full_name|default:msg.recipient.username }}</div>
              </div>
              <div class="text-end">
                <span class="badge {% if msg.importance == 'high' %}bg-danger{% elif msg.importance == 'normal' %}bg-primary{% else %}bg-secondary{% endif %}">
                  {{ msg.get_importance_display }}
                </span>
                <div class="small text-muted mt-1">{{ msg.sent_at|date:"M d, Y H:i" }}</div>
              </div>
            </div>
            {% if msg.body %}
              <p class="mb-2 mt-2 text-muted">{{ msg.body|truncatechars:140 }}</p>
            {% endif %}
            <div class="d-flex gap-2">
              <a href="{% url 'message_detail' msg.pk %}" class="btn btn-outline-primary btn-sm">View</a>
              <form method="POST" action="{% url 'delete_message' msg.pk %}">
                {% csrf_token %}
                <button type="submit" class="btn btn-outline-danger btn-sm" onclick="return confirm('Delete this message?');">Delete</button>
              </form>
            </div>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <div class="alert alert-info">You havenâ€™t sent any messages yet.</div>
    {% endif %}
  {% endwith %}
</div>
{% endblock %}