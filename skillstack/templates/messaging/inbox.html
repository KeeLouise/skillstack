{% extends 'base.html' %}
{% block title %}Messages{% endblock %}

{% block content %}
<div class="container mt-5">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="mb-0">
      Messages
      {% if unread_count > 0 %}
        <span class="badge bg-danger">{{ unread_count }}</span>
      {% endif %}
    </h2>
    <a href="{% url 'compose' %}" class="btn btn-dark">New Message</a>
  </div>

  <form method="get" class="mb-3 d-flex">
    <input type="text" name="q" class="form-control me-2" placeholder="Search messages..."
           value="{{ query|default:'' }}">
    <button type="submit" class="btn btn-outline-primary">Search</button>
  </form>

  <ul class="nav nav-tabs mb-3">
    <li class="nav-item">
      <a class="nav-link {% if active_tab == 'inbox' %}active{% endif %}" href="{% url 'messages' %}">
        Inbox {% if unread_count > 0 %}<span class="badge bg-secondary">{{ unread_count }}</span>{% endif %}
      </a>
    </li>
    <li class="nav-item">
      <a class="nav-link {% if active_tab == 'sent' %}active{% endif %}" href="{% url 'sent' %}">Sent</a>
    </li>
  </ul>

  {% if messages %}
    <div class="list-group">
      {% for msg in messages %}
        <a href="{% url 'message_detail' msg.pk %}" class="list-group-item list-group-item-action {% if not msg.is_read %}fw-bold bg-light{% endif %}">
          <div class="d-flex w-100 justify-content-between">
            <h5 class="mb-1">{{ msg.subject }}</h5>
            <small>{{ msg.sent_at|date:"M d, Y H:i" }}</small>
          </div>
          <p class="mb-1 text-muted">
            {% if active_tab == 'inbox' %}From: {{ msg.sender.username }}
            {% else %}To: {{ msg.recipient.username }}
            {% endif %}
          </p>
        </a>
      {% endfor %}
    </div>
  {% else %}
    <div class="alert alert-info text-center">No messages found.</div>
  {% endif %}
</div>
{% endblock %}