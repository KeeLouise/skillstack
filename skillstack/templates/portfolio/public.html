{% extends "base.html" %}
{% load static %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'css/portfolio.css' %}">
<link rel="canonical" href="{{ request.build_absolute_uri }}">
<meta property="og:title" content="{{ owner.first_name|default:owner.username }} — Portfolio">
<meta property="og:type" content="website">
<meta property="og:url" content="{{ request.build_absolute_uri }}">
{% if og_image %}
  <meta property="og:image" content="{{ og_image }}">
{% endblock %}

{% block title %}{{ owner.first_name|default:owner.username }} — Portfolio{% endblock %}

{% block content %}
<div class="container py-5">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="mb-0">{{ owner.first_name|default:owner.username }}’s Portfolio</h2>
    <a href="{% url 'dashboard' %}" class="btn btn-outline-secondary">Home</a>
  </div>

  {% for item in links %}
  {% with img=item.image_file.url|default:item.image_url %}
    {% if img %}
      {% if img|slice:":4" == "http" %}
        {% with display=img %}
          <a class="portfolio-card" href="{{ item.url }}" target="_blank" rel="noopener noreferrer">
            <div class="portfolio-thumb" style="background-image:url('{{ display }}')"></div>
            <div class="portfolio-info">
              <div class="title text-truncate">{{ item.title|default:item.url }}</div>
              <div class="url text-muted text-truncate">{{ item.url }}</div>
            </div>
          </a>
        {% endwith %}
      {% else %}
        {% with display=request.build_absolute_uri(img) %}
          <a class="portfolio-card" href="{{ item.url }}" target="_blank" rel="noopener noreferrer">
            <div class="portfolio-thumb" style="background-image:url('{{ display }}')"></div>
            <div class="portfolio-info">
              <div class="title text-truncate">{{ item.title|default:item.url }}</div>
              <div class="url text-muted text-truncate">{{ item.url }}</div>
            </div>
          </a>
        {% endwith %}
      {% endif %}
    {% else %}
      {% with display=static('images/og/portfolio-default.jpg') %}
        <a class="portfolio-card" href="{{ item.url }}" target="_blank" rel="noopener noreferrer">
          <div class="portfolio-thumb" style="background-image:url('{{ display }}')"></div>
          <div class="portfolio-info">
            <div class="title text-truncate">{{ item.title|default:item.url }}</div>
            <div class="url text-muted text-truncate">{{ item.url }}</div>
          </div>
        </a>
      {% endwith %}
    {% endif %}
  {% endwith %}
{% endfor %}
    </div>
  {% else %}
    <div class="card p-5 text-center shadow-sm">
      <h5 class="mb-2">No links yet</h5>
      <p class="text-muted mb-0">Check back soon.</p>
    </div>
  {% endif %}
</div>
{% endblock %}